---
version: 1

kind: group

tags: [group]

hptuning:
  matrix:
    data_root:
      values: [ /data/Chrissi_US_augmentation/BoneSegmentationNoise/cross_val0, /data/Chrissi_US_augmentation/BoneSegmentationNoise/cross_val1,
                /data/Chrissi_US_augmentation/BoneSegmentationNoise/cross_val2, /data/Chrissi_US_augmentation/BoneSegmentationNoise/cross_val3,
                /data/Chrissi_US_augmentation/BoneSegmentationNoise/cross_val4]

    use_positive_weights:
      values: [ True, False]

    loss_function:
      values: [ 'BCE+Dice', 'BCE' ]

build:
  image: pytorch/pytorch:1.7.1-cuda11.0-cudnn8-runtime
  build_steps:
    - apt-get update
    - apt install -y libgl1-mesa-glx
    - apt-get install -y libglib2.0-0 libsm6 libxext6 libxrender-dev
    - pip install -r requirements.txt

environment:
  resources:
    cpu:
      requests: 4
      limits: 8
    memory:
      requests: 8192

    gpu:
      requests: 1
      limits: 1

declarations:
  config_file: config/bone_segmentation_polyaxon.yml

run:
  cmd:
   - python -u train.py -c={{ config_file }} \
                         --data_root={{ data_root }}
                         --use_positive_weights={{ use_positive_weights }}
                         --loss_function={{ loss_function }}
                         --on_polyaxon
